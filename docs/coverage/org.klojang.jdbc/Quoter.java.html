<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Quoter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Klojang JDBC</a> &gt; <a href="index.source.html" class="el_package">org.klojang.jdbc</a> &gt; <span class="el_source">Quoter.java</span></div><h1>Quoter.java</h1><pre class="source lang-java linenums">package org.klojang.jdbc;

import org.klojang.jdbc.x.JDBC;

import java.sql.SQLException;
import java.sql.Statement;

/**
 * &lt;p&gt;Escapes and quotes values according to the target database's quoting and escaping
 * rules. Quoters can be used when executing {@link SQLBatchInsert batch inserts}. You
 * don't normally need to concern yourself with quoting and escaping unless you want to
 * {@link Transformer#transform(Object, Object, Quoter) tranform} a value into a
 * {@linkplain SQLExpression SQL expression} before saving it to the database. SQL
 * expressions will be injected as-is into the INSERT statement. &lt;i&gt;Klojang JDBC&lt;/i&gt; will
 * not attempt to &quot;understand&quot; them. That makes you responsible for protecting yourself
 * against SQL injection. Using a {@code Quoter} gives you just as much protection as
 * {@link java.sql.PreparedStatement prepared statements} as it completely outsources the
 * quoting and escaping to the JDBC driver.
 *
 * &lt;p&gt;&lt;b&gt;Only use a {@code Quoter} to escape and quote strings &lt;i&gt;within&lt;/i&gt; the SQL
 * expression&lt;/b&gt;. In any other case escaping and quoting is taken care of by &lt;i&gt;Klojang
 * JDBC&lt;/i&gt;, if not simply by JDBC itself.
 *
 * &lt;p&gt;Here is a clear (but not very useful) example of where and how you can use a
 * {@code Quoter}:
 *
 * &lt;blockquote&gt;&lt;pre&gt;{@code
 * BatchInsertBuilder builder = SQL.prepareBatchInsert()
 *    .withTransformer(&quot;lastName&quot;, (bean, value, quoter) -&gt; {
 *      String quoted = quoter.escapeAndQuote(value);
 *      String expression = String.format(&quot;LTRIM(%s)&quot;, quoted);
 *      return SQL.expression(expression);
 *    });
 * }&lt;/pre&gt;&lt;/blockquote&gt;
 *
 * @see SQLExpression
 * @see Statement#enquoteLiteral(String)
 * @see BatchInsertBuilder#withTransformer(String, Transformer)
 */
public final class Quoter {

  private final Statement stmt;

<span class="nc" id="L44">  Quoter(Statement stmt) {</span>
<span class="nc" id="L45">    this.stmt = stmt;</span>
<span class="nc" id="L46">  }</span>

  /**
   * &lt;p&gt;Returns a properly escaped and quoted string. This method behaves as follows:
   *
   * &lt;ul&gt;
   *   &lt;li&gt;if the argument is {@code null}, this method returns the literal,
   *   &lt;i&gt;unquoted&lt;/i&gt; string &quot;NULL&quot;
   *   &lt;li&gt;if the argument is an {@link SQL#expression(String) SQL expression}, a
   *   {@link Number} or a {@link Boolean}, this method returns {@code value.toString()}
   *   (in other words, it returns an &lt;i&gt;unquoted&lt;/i&gt; string)
   *   &lt;li&gt;else this method returns the result of quoting and escaping
   *   {@code value.toString()} according to the target database's quoting and escaping
   *   rules
   * &lt;/ul&gt;
   *
   * @param value the value to quote
   * @return a properly escaped and quoted string
   * @throws SQLException if a database error occurs
   * @see Statement#enquoteLiteral(String)
   */
  public String escapeAndQuote(Object value) throws SQLException {
<span class="nc" id="L68">    return JDBC.quote(stmt, value);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>